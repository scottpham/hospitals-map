function draw_graphic(){if(Modernizr.svg){$("#map").empty();var t=$("#map").width();render(t)}}function render(t){function e(t,e){var r=s.latLngToLayerPoint(new L.LatLng(e,t));this.stream.point(r.x,r.y)}function r(){bounds=d.bounds(hospitals);var t=bounds[0],e=bounds[1];i.attr("width",e[0]-t[0]).attr("height",e[1]-t[1]).style("left",t[0]+"px").style("top",t[1]+"px"),c.attr("transform","translate("+-t[0]+","+-t[1]+")"),l()}function o(){var t=c.selectAll(".hospitals").data(hospitals.features).enter().append("circle").attr("r",function(t){var e=t.properties.num_spc_one;return console.log(t),2*e+8}).attr("class","hospitals").style("fill",function(t){return t.properties.color}).style("opacity",.8).style("stroke","white").style("stroke-width",.3).on("mouseover",function(t,e){y.show(t),d3.select(this).each(w)}).on("mouseout",function(t,e){y.hide(t),d3.select(this).each(b)}).on("click",a)}function a(t){console.log(t.properties)}function n(t){console.log(t.latlng)}function l(){c.selectAll(".hospitals").attr("transform",function(t){return"translate("+s.latLngToLayerPoint(t.LatLng).x+","+s.latLngToLayerPoint(t.LatLng).y+")"})}var s=new L.Map("map",{center:[37.74,-122.31],zoom:11,scrollWheelZoom:!1}).addLayer(new L.TileLayer("http://api.tiles.mapbox.com/v4/nbclocal.k38kb5c1/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibmJjbG9jYWwiLCJhIjoiS3RIUzNQOCJ9.le_LAljPneLpb7tBcYbQXQ",{attribution:'Map tiles by MapBox. Data by <a href="http://openstreetmap.org">OpenStreetMap</a>, under <a href="http://creativecommons.org/licenses/by-sa/3.0">CC BY SA</a>.'})),i=d3.select(s.getPanes().overlayPane).append("svg"),c=i.append("g").attr("class","leaflet-zoom-hide"),p=d3.geo.transform({point:e}),d=d3.geo.path().projection(p);s.on("viewreset",r),r();var u=d3.select("#map").append("div").attr("class","tooltip").style("opacity",0),h=function(t){return t?d3.format("%")(t):"0%"},y=d3.tip().attr("class","d3-tip").style("max-width","150px").offset([-10,0]).html(function(t){return"Name</br>"+t.properties.Name+" complete.</br>SPC1 Buildings: "+t.properties.num_spc1});c.call(y),hospitals.features.forEach(function(t){t.LatLng=new L.LatLng(t.geometry.coordinates[1],t.geometry.coordinates[0])});var f="darkgreen",g="darkred";hospitals.features.forEach(function(t){t.properties.color="False"==t.properties.one_or_mo?f:g,t.properties.num_spc_one=+t.properties.num_spc1,console.log(t.properties.num_spc_one)}),o();var m={original:0},w=function(){this.parentNode.appendChild(this),m.original=d3.select(this).attr("r"),d3.select(this).attr("r",30).style("opacity",.9).style("stroke-width",1.5)},b=function(){var t=this.parentNode.firstChild;t&&this.parentNode.insertBefore(this,t),d3.select(this).attr("r",m.original).style("opacity",.8).style("stroke-width",.5)};s.on("click",n),l();var A=function(t,e){return.8*e},v=5,C=d3.select("#map").append("svg").attr("width",300).attr("height",115);C.append("rect").style("fill","white").attr("width",300).attr("height",100).attr("x","50").attr("y","2").style("opacity",.8),C.append("g").attr("class","circleKey").selectAll("g").data([{color:g,text:"Hospitals has SPC1 Buildings"},{color:f,text:"No SPC1 Buildings"}]).enter().append("g").attr("class","colorsGroup").attr("transform","translate(75, 30)");var F=15;C.selectAll(".colorsGroup").append("circle").style("stroke-width",2).style("fill",function(t){return t.color}).style("stroke","black").attr("r",F).attr("cy",function(t,e){return e*F*3}),C.selectAll(".colorsGroup").append("text").style("font-size",15).attr("x",1.5*F).attr("y",function(t,e){return 3*F*e+5}).text(function(t){return t.text})}var circleSize=70,colors={red1:"#6C2315",red2:"#A23520",red3:"#D8472B",red4:"#E27560",red5:"#ECA395",red6:"#F5D1CA",orange1:"#714616",orange2:"#AA6A21",orange3:"#E38D2C",orange4:"#EAAA61",orange5:"#F1C696",orange6:"#F8E2CA",yellow1:"#77631B",yellow2:"#B39429",yellow3:"#EFC637",yellow4:"#F3D469",yellow5:"#F7E39B",yellow6:"#FBF1CD",teal1:"#0B403F",teal2:"#11605E",teal3:"#17807E",teal4:"#51A09E",teal5:"#8BC0BF",teal6:"#C5DFDF",blue1:"#28556F",blue2:"#3D7FA6",blue3:"#51AADE",blue4:"#7DBFE6",blue5:"#A8D5EF",blue6:"#D3EAF7"};$(window).load(function(){draw_graphic()});